<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Semi-parametric spatial filtering — SpatialFiltering • spatialreg</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Semi-parametric spatial filtering — SpatialFiltering"><meta name="description" content="The function selects eigenvectors in a semi-parametric spatial filtering approach to removing spatial dependence from linear models. Selection is by brute force by finding the single eigenvector reducing the standard variate of Moran's I for regression residuals most, and continuing until no candidate eigenvector reduces the value by more than tol. It returns a summary table from the selection process and a matrix of selected eigenvectors for the specified model."><meta property="og:description" content="The function selects eigenvectors in a semi-parametric spatial filtering approach to removing spatial dependence from linear models. Selection is by brute force by finding the single eigenvector reducing the standard variate of Moran's I for regression residuals most, and continuing until no candidate eigenvector reduces the value by more than tol. It returns a summary table from the selection process and a matrix of selected eigenvectors for the specified model."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spatialreg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/nb_igraph.html">Spatial weights objects as sparse matrices and graphs</a></li>
    <li><a class="dropdown-item" href="../articles/sids_models.html">North Carolina SIDS data set (models)</a></li>
    <li><a class="dropdown-item" href="../articles/SpatialFiltering.html">Moran Eigenvectors</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-spatial/spatialreg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Semi-parametric spatial filtering</h1>

      <div class="d-none name"><code>SpatialFiltering.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function selects eigenvectors in a semi-parametric spatial filtering approach to removing spatial dependence from linear models. Selection is by brute force by finding the single eigenvector reducing the standard variate of Moran's I for regression residuals most, and continuing until no candidate eigenvector reduces the value by more than <code>tol</code>. It returns a summary table from the selection process and a matrix of selected eigenvectors for the specified model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">SpatialFiltering</span><span class="op">(</span><span class="va">formula</span>, lagformula<span class="op">=</span><span class="cn">NULL</span>, data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, na.action<span class="op">=</span><span class="va">na.fail</span>,</span>
<span> nb<span class="op">=</span><span class="cn">NULL</span>, glist <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span> style <span class="op">=</span> <span class="st">"C"</span>, zero.policy <span class="op">=</span> <span class="cn">NULL</span>, tol <span class="op">=</span> <span class="fl">0.1</span>, zerovalue <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span> ExactEV <span class="op">=</span> <span class="cn">FALSE</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span>, alpha<span class="op">=</span><span class="cn">NULL</span>, alternative<span class="op">=</span><span class="st">"two.sided"</span>,</span>
<span> verbose<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>a symbolic description of the model to be fit, assuming a spatial error representation; when lagformula is given, it should include only the response and the intercept term</p></dd>

  <dt id="arg-lagformula">lagformula<a class="anchor" aria-label="anchor" href="#arg-lagformula"></a></dt>
<dd><p>An extra one-sided formula to be used when a spatial lag representation is desired; the intercept is excluded within the function if present because it is part of the formula argument, but excluding it explicitly in the lagformula argument in the presence of factors generates a collinear model matrix</p></dd>

  <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>an optional data frame containing the variables in the model</p></dd>

  <dt id="arg-nb">nb<a class="anchor" aria-label="anchor" href="#arg-nb"></a></dt>
<dd><p>an object of class <code>nb</code></p></dd>

  <dt id="arg-glist">glist<a class="anchor" aria-label="anchor" href="#arg-glist"></a></dt>
<dd><p>list of general weights corresponding to neighbours</p></dd>

  <dt id="arg-style">style<a class="anchor" aria-label="anchor" href="#arg-style"></a></dt>
<dd><p><code>style</code> can take values W, B, C, U, and S</p></dd>

  <dt id="arg-na-action">na.action<a class="anchor" aria-label="anchor" href="#arg-na-action"></a></dt>
<dd><p>a function (default <code>options("na.action")</code>), can also be <code>na.omit</code> or <code>na.exclude</code> with consequences for residuals and fitted values - in these cases the spatial weights list will be subsetted to remove NAs in the data. It may be necessary to set zero.policy to TRUE because this subsetting may create no-neighbour observations. Note that only weights lists created without using the glist argument to <code>nb2listw</code> may be subsetted.</p></dd>

  <dt id="arg-zero-policy">zero.policy<a class="anchor" aria-label="anchor" href="#arg-zero-policy"></a></dt>
<dd><p>default NULL, use global option value; if FALSE stop with error for any empty neighbour sets, if TRUE permit the weights list to be formed with zero-length weights vectors</p></dd>

  <dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>tolerance value for convergence of spatial filtering</p></dd>

  <dt id="arg-zerovalue">zerovalue<a class="anchor" aria-label="anchor" href="#arg-zerovalue"></a></dt>
<dd><p>eigenvectors with eigenvalues of an absolute value smaller than zerovalue will be excluded in eigenvector search</p></dd>

  <dt id="arg-exactev">ExactEV<a class="anchor" aria-label="anchor" href="#arg-exactev"></a></dt>
<dd><p>Set ExactEV=TRUE to use exact expectations and variances rather than the expectation and variance of Moran's I from the previous iteration, default FALSE</p></dd>

  <dt id="arg-symmetric">symmetric<a class="anchor" aria-label="anchor" href="#arg-symmetric"></a></dt>
<dd><p>Should the spatial weights matrix be forced to symmetry, default TRUE</p></dd>

  <dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>if not NULL, used instead of the tol= argument as a stopping rule to choose all eigenvectors up to and including the one with a probability value exceeding alpha.</p></dd>

  <dt id="arg-alternative">alternative<a class="anchor" aria-label="anchor" href="#arg-alternative"></a></dt>
<dd><p>a character string specifying the alternative hypothesis, must be one of greater, less or two.sided (default).</p></dd>

  <dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>default NULL, use global option value; if TRUE report eigenvectors selected</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>SfResult</code> object, with:</p>
<dl><dt>selection</dt>
<dd><p>a matrix summarising the selection of eigenvectors for inclusion, with columns:</p><dl><dt>Step</dt>
<dd><p>Step counter of the selection procedure</p></dd>

      <dt>SelEvec</dt>
<dd><p>number of selected eigenvector (sorted descending)</p></dd>

      <dt>Eval</dt>
<dd><p>its associated eigenvalue</p></dd>

      <dt>MinMi</dt>
<dd><p>value Moran's I for residual autocorrelation</p></dd>

      <dt>ZMinMi</dt>
<dd><p>standardized value of Moran's I assuming a normal approximation</p></dd>

      <dt>pr(ZI)</dt>
<dd><p>probability value of the permutation-based standardized deviate for the given value of the alternative argument</p></dd>

      <dt>R2</dt>
<dd><p>R^2 of the model including exogenous variables and eigenvectors</p></dd>

      <dt>gamma</dt>
<dd><p>regression coefficient of selected eigenvector in fit</p></dd>


</dl><p>The first row is the value at the start of the search</p></dd>

  <dt>dataset</dt>
<dd><p>a matrix of the selected eigenvectors in order of selection</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Tiefelsdorf M, Griffith DA. (2007) Semiparametric Filtering of Spatial Autocorrelation: The Eigenvector Approach. Environment and Planning A, 39 (5) 1193 - 1221.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Yongwan Chun, Michael Tiefelsdorf, Roger Bivand</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code>, <code><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></code>, <code><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html" class="external-link">nb2listw</a></code>, <code><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html" class="external-link">listw2U</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://r-spatial.github.io/sf/" class="external-link">"sf"</a></span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">columbus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shapes/columbus.gpkg"</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#require("spdep", quietly=TRUE)</span></span></span>
<span class="r-in"><span><span class="va">col.gal.nb</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/read.gal.html" class="external-link">read.gal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"weights/columbus.gal"</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lmbase</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span>, data<span class="op">=</span><span class="va">columbus</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sarcol</span> <span class="op">&lt;-</span> <span class="fu">SpatialFiltering</span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span>, data<span class="op">=</span><span class="va">columbus</span>,</span></span>
<span class="r-in"><span> nb<span class="op">=</span><span class="va">col.gal.nb</span>, style<span class="op">=</span><span class="st">"W"</span>, ExactEV<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sarcol</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Step SelEvec      Eval        MinMi      ZMinMi      Pr(ZI)        R2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0    0       0 0.0000000  0.212374153  2.68100025 0.007340246 0.5524040</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    1       5 0.7148326  0.121528166  1.89037770 0.058707464 0.6209393</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    2       3 0.8408661  0.065848648  1.54064108 0.123404165 0.6481722</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    3       1 1.0206316 -0.005424824  1.08514557 0.277857187 0.6726114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    4      10 0.3658588 -0.039356232  0.80357070 0.421644951 0.7000258</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    5      14 0.1831325 -0.072949543  0.47790213 0.632719864 0.7393770</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    6      11 0.3144120 -0.108332631  0.18566599 0.852706701 0.7611907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7    7       2 0.9157325 -0.153675621 -0.03464097 0.972366030 0.7713163</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       gamma</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0   0.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  30.34786</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  19.13010</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 -18.12234</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 -19.19379</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  22.99586</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  17.12127</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  11.66487</span>
<span class="r-in"><span><span class="va">lmsar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">sarcol</span><span class="op">)</span>, data<span class="op">=</span><span class="va">columbus</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lmsar</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = CRIME ~ INC + HOVAL + fitted(sarcol), data = columbus)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Min       1Q   Median       3Q      Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -27.6527  -5.3084   0.0804   5.6844  15.6912 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          68.61896    3.67609  18.666  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INC                  -1.59731    0.25938  -6.158 3.12e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HOVAL                -0.27393    0.08011  -3.419  0.00148 ** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec5   30.34786    8.87679   3.419  0.00149 ** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec3   19.13010    8.87679   2.155  0.03739 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec1  -18.12234    8.87679  -2.042  0.04800 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec10 -19.19379    8.87679  -2.162  0.03679 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec14  22.99586    8.87679   2.591  0.01341 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec11  17.12127    8.87679   1.929  0.06106 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec2   11.66487    8.87679   1.314  0.19649    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 8.877 on 39 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.7713,	Adjusted R-squared:  0.7185 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 14.62 on 9 and 39 DF,  p-value: 5.579e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                        Estimate Std. Error   t value     Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          68.6189611 3.67608656 18.666307 4.802352e-21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INC                  -1.5973108 0.25938068 -6.158172 3.122801e-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HOVAL                -0.2739315 0.08011158 -3.419374 1.483698e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec5   30.3478552 8.87679493  3.418785 1.486164e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec3   19.1300996 8.87679493  2.155068 3.738943e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec1  -18.1223409 8.87679493 -2.041541 4.800339e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec10 -19.1937947 8.87679493 -2.162244 3.679422e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec14  22.9958588 8.87679493  2.590559 1.340783e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec11  17.1212741 8.87679493  1.928768 6.106079e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(sarcol)vec2   11.6648669 8.87679493  1.314085 1.964945e-01</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">lmbase</span>, <span class="va">lmsar</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Analysis of Variance Table</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model 1: CRIME ~ INC + HOVAL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model 2: CRIME ~ INC + HOVAL + fitted(sarcol)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     46 6014.9                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     39 3073.1  7    2941.8 5.3334 0.0002445 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-in"><span><span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lm.morantest.html" class="external-link">lm.morantest</a></span><span class="op">(</span><span class="va">lmsar</span>, <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html" class="external-link">nb2listw</a></span><span class="op">(</span><span class="va">col.gal.nb</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Global Moran I for regression residuals</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> model: lm(formula = CRIME ~ INC + HOVAL + fitted(sarcol), data =</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> columbus)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> weights: spdep::nb2listw(col.gal.nb)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Moran I statistic standard deviate = -0.034641, p-value = 0.5138</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: greater</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed Moran I      Expectation         Variance </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -0.153675621     -0.150918131      0.006336477 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">lagcol</span> <span class="op">&lt;-</span> <span class="fu">SpatialFiltering</span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="fl">1</span>, <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span> <span class="op">-</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">columbus</span>,</span></span>
<span class="r-in"><span> nb<span class="op">=</span><span class="va">col.gal.nb</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lagcol</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Step SelEvec      Eval       MinMi      ZMinMi      Pr(ZI)        R2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0     0       0 0.0000000  0.21237415  2.68100025 0.007340246 0.5524040</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     1       6 0.7161123  0.11782248  1.84511963 0.065020139 0.6038801</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     2       4 0.8682938  0.06242664  1.49482111 0.134961136 0.6531288</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     3       1 1.0310063 -0.02066604  0.88134183 0.378132834 0.6924845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     4       5 0.7905397 -0.04619973  0.84746904 0.396733736 0.7136578</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     5      15 0.1753342 -0.07609524  0.55233191 0.580720971 0.7558543</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     6       9 0.5501433 -0.10190889  0.43919419 0.660520837 0.7626784</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7     7       8 0.5721041 -0.12232942  0.41846803 0.675604953 0.7757314</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8     8       3 0.9026222 -0.14991822  0.38315383 0.701605709 0.7908693</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     9       2 0.9649166 -0.21756342 -0.28556733 0.775209527 0.8078727</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10   10       7 0.6219404 -0.22017920 -0.04856547 0.961265592 0.8082842</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         gamma</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0    0.000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   19.848854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  -35.542595</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  -30.697851</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  -24.540372</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   25.227798</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    7.590082</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  -16.933168</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  -20.556931</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  -18.434534</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  -2.597572</span>
<span class="r-in"><span><span class="va">lmlag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">lagcol</span><span class="op">)</span>, data<span class="op">=</span><span class="va">columbus</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lmlag</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = CRIME ~ INC + HOVAL + fitted(lagcol), data = columbus)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         (Intercept)                  INC                HOVAL  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             56.7977              -0.4857              -0.3821  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  fitted(lagcol)vec6   fitted(lagcol)vec4   fitted(lagcol)vec1  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             19.8489             -35.5426             -30.6979  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  fitted(lagcol)vec5  fitted(lagcol)vec15   fitted(lagcol)vec9  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            -24.5404              25.2278               7.5901  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  fitted(lagcol)vec8   fitted(lagcol)vec3   fitted(lagcol)vec2  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            -16.9332             -20.5569             -18.4345  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  fitted(lagcol)vec7  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             -2.5976  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">lmbase</span>, <span class="va">lmlag</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Analysis of Variance Table</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model 1: CRIME ~ INC + HOVAL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model 2: CRIME ~ INC + HOVAL + fitted(lagcol)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     46 6014.9                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     36 2576.3 10    3438.6 4.8049 0.0002165 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-in"><span><span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/lm.morantest.html" class="external-link">lm.morantest</a></span><span class="op">(</span><span class="va">lmlag</span>, <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html" class="external-link">nb2listw</a></span><span class="op">(</span><span class="va">col.gal.nb</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Global Moran I for regression residuals</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> model: lm(formula = CRIME ~ INC + HOVAL + fitted(lagcol), data =</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> columbus)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> weights: spdep::nb2listw(col.gal.nb)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Moran I statistic standard deviate = -0.048565, p-value = 0.5194</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: greater</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed Moran I      Expectation         Variance </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -0.220179195     -0.217083975      0.004061888 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">NA.columbus</span> <span class="op">&lt;-</span> <span class="va">columbus</span></span></span>
<span class="r-in"><span><span class="va">NA.columbus</span><span class="op">$</span><span class="va">CRIME</span><span class="op">[</span><span class="fl">20</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="va">COL.SF.NA</span> <span class="op">&lt;-</span> <span class="fu">SpatialFiltering</span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span>, data<span class="op">=</span><span class="va">NA.columbus</span>,</span></span>
<span class="r-in"><span> nb<span class="op">=</span><span class="va">col.gal.nb</span>, style<span class="op">=</span><span class="st">"W"</span>, na.action<span class="op">=</span><span class="va">na.exclude</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>subsetting caused increase in subgraph count</span>
<span class="r-in"><span><span class="va">COL.SF.NA</span><span class="op">$</span><span class="va">na.action</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20 21 22 23 24 25 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20 21 22 23 24 25 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "exclude"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">CRIME</span> <span class="op">~</span> <span class="va">INC</span> <span class="op">+</span> <span class="va">HOVAL</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">COL.SF.NA</span><span class="op">)</span>, data<span class="op">=</span><span class="va">NA.columbus</span>,</span></span>
<span class="r-in"><span> na.action<span class="op">=</span><span class="va">na.exclude</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = CRIME ~ INC + HOVAL + fitted(COL.SF.NA), data = NA.columbus, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     na.action = na.exclude)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Min       1Q   Median       3Q      Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -23.6712  -4.7984   0.1761   6.7460  11.3353 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)         69.04674    3.91643  17.630  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> INC                 -1.60115    0.26017  -6.154 3.88e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HOVAL               -0.28742    0.07716  -3.725 0.000649 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(COL.SF.NA)1 -39.91305    8.23597  -4.846 2.27e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(COL.SF.NA)2  19.81805    8.23597   2.406 0.021226 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fitted(COL.SF.NA)3 -35.07336    8.23597  -4.259 0.000135 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 8.236 on 37 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (6 observations deleted due to missingness)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.7772,	Adjusted R-squared:  0.7471 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 25.81 on 5 and 37 DF,  p-value: 3.996e-11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Roger Bivand, Gianfranco Piras.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

